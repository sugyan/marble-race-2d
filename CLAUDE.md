# 2D Marble Race

## プロジェクト概要

iPad横向き全画面表示を前提とした2Dマーブルレースシミュレーション。
複数のボールが物理エンジンにより予測困難な動きをしながらゴールを目指す。

## 技術スタック

- **フレームワーク**: React 19.2.0 + TypeScript
- **ビルドツール**: Vite 7.2.4 (SWC)
- **物理エンジン**: Matter.js
- **レンダリング**: Matter.js組み込みレンダラー (Canvas API)

## 実装機能

### コア機能

1. **物理シミュレーション**
   - Matter.jsによるリアルな2D物理演算
   - スリープモード無効化（`enableSleeping: false`）でボールが止まりにくい設定
   - 重力: `{ x: 0, y: 1 }`

2. **ボール**
   - 10個のカラフルなボール
   - 画面サイズに応じて動的にサイズ調整（画面サイズの1.5%）
   - 物理パラメータ:
     - `restitution: 0.9` - 高い弾性（よく弾む）
     - `friction: 0.001` - 極めて低い摩擦（滑りやすい）
     - `frictionStatic: 0` - 静止摩擦ゼロ（止まりにくい）
     - `frictionAir: 0.0005` - 低い空気抵抗

3. **コース設計**
   - 階段状の傾斜プラットフォーム（5つ）
   - 左右に振動する動く障害物
   - すべての座標を相対位置で管理（画面サイズの％指定）
   - プラットフォームの物理パラメータ:
     - `friction: 0.001` - 低摩擦
     - `restitution: 0.8` - 高反発

4. **ゴールシステム**
   - 画面下部に緑色（`#00FF00`）のゴールライン
   - `isSensor: true` でボールはすり抜けるが衝突検知は有効
   - ゴール到達時にボールを削除

5. **UI機能**
   - リアルタイムランキング表示（右側パネル）
   - ゴール順に自動ソート
   - ボール番号と色で識別

### レスポンシブ対応

- **全画面表示**: 100vw × 100vh を使用
- **動的Canvas サイズ**: ランキングパネル（250px）を除いた領域に自動調整
- **相対座標系**: すべてのオブジェクト位置を画面サイズに対する比率で管理

## プロジェクト構成

```
src/
├── components/
│   └── MarbleRace.tsx    # メインコンポーネント（物理エンジン、レンダリング、UI）
├── App.tsx               # ルートコンポーネント
├── App.css              # アプリケーションスタイル
├── main.tsx             # エントリーポイント
└── index.css            # グローバルスタイル
```

## 自動動作

- ページ読み込み完了後、自動的にレース開始
- ボタン操作不要（以前のStart/Resetボタンは削除済み）

## 物理エンジン調整のポイント

### 止まりにくくするための設定

1. **スリープ無効化**: Matter.jsはデフォルトで静止したボディを「眠らせる」が、これを無効化
2. **静止摩擦ゼロ**: 静止状態からの動き出しを容易に
3. **極低摩擦**: 動摩擦を限りなくゼロに近づける
4. **高反発**: 衝突時のエネルギー損失を最小化

### 予測困難性の実現

1. 傾斜プラットフォームの角度調整（0.1〜0.15ラジアン）
2. 動く障害物の周期的な動き（sin波）
3. ボール同士の衝突による連鎖反応

## 今後の拡張可能性

- ボール数の調整機能
- 障害物パターンのバリエーション
- リプレイ機能
- 統計情報の表示（平均時間、最速記録など）
- コースエディター
- 複数レーン対応
